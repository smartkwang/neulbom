<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선착순 연수 예약 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .time-slot {
            transition: all 0.3s ease;
        }
        .time-slot:hover:not(.selected):not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .time-slot.selected {
            border: 2px solid #4F46E5;
            background-color: #EEF2FF;
        }
        .time-slot.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .progress-bar {
            height: 0.5rem;
            border-radius: 0.25rem;
            background-color: #E5E7EB;
        }
        .progress-fill {
            height: 100%;
            border-radius: 0.25rem;
            background-color: #4F46E5;
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .field-error {
            border-color: #EF4444 !important;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700 mb-2">선착순 연수 예약 시스템</h1>
            <p class="text-gray-600">2025년 5월 행사 예약</p>
            <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-yellow-500"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-yellow-700">
                            본 행사는 각 타임당 20명씩, 하루 100명, 총 300명이 참가 가능합니다. 참가자는 전체 행사 중 오직 1타임만 참석할 수 있습니다.
                        </p>
                    </div>
                </div>
            </div>
        </header>
<!-- 메인 폼 -->
    <main class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <form id="registrationForm">
            <!-- 날짜 및 시간 선택 섹션 -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">1. 날짜 및 시간 선택</h2>
                
                <!-- 날짜 선택 탭 -->
                <div class="mb-6">
                    <div class="flex border-b border-gray-200">
                        <button type="button" class="date-tab flex-1 py-3 px-4 text-center font-medium border-b-2 border-indigo-500 text-indigo-600" data-date="2025-05-22">5월 22일 (목)</button>
                        <button type="button" class="date-tab flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-date="2025-05-23">5월 23일 (금)</button>
                        <button type="button" class="date-tab flex-1 py-3 px-4 text-center font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-date="2025-05-30">5월 30일 (금)</button>
                    </div>
                </div>

                <!-- 시간 선택 그리드 -->
                <div>
                    <!-- 5월 22일 시간대 -->
                    <div class="date-slots" id="slots-2025-05-22">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-22" data-time="09:30-10:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">09:30 - 10:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-22" data-time="10:00-10:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:00 - 10:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-22" data-time="10:30-11:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:30 - 11:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-22" data-time="11:00-11:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:00 - 11:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-22" data-time="11:30-12:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:30 - 12:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5월 23일 시간대 -->
                    <div class="date-slots hidden" id="slots-2025-05-23">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-23" data-time="09:30-10:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">09:30 - 10:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-23" data-time="10:00-10:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:00 - 10:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-23" data-time="10:30-11:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:30 - 11:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-23" data-time="11:00-11:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:00 - 11:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-23" data-time="11:30-12:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:30 - 12:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5월 30일 시간대 -->
                    <div class="date-slots hidden" id="slots-2025-05-30">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-30" data-time="09:30-10:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">09:30 - 10:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-30" data-time="10:00-10:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:00 - 10:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-30" data-time="10:30-11:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10:30 - 11:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-30" data-time="11:00-11:30">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:00 - 11:30</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="time-slot p-4 border rounded-lg cursor-pointer" data-date="2025-05-30" data-time="11:30-12:00">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">11:30 - 12:00</span>
                                    <span class="text-sm bg-green-100 text-green-800 py-1 px-2 rounded-full">
                                        <span class="remaining-count">20</span>/<span class="total-count">20</span>
                                    </span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 hidden text-red-500" id="timeSelectionError">시간을 선택해주세요.</div>
                <input type="hidden" id="selectedDate" name="selectedDate">
                <input type="hidden" id="selectedTime" name="selectedTime">
                <input type="hidden" id="selectedDateTime" name="selectedDateTime">
            </section>

            <!-- 개인정보 입력 섹션 -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">2. 개인정보 입력</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">이름 <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="홍길동" required>
                        <div class="mt-1 hidden text-red-500 text-sm" id="nameError">이름을 입력해주세요.</div>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">이메일 <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="example@example.com" required>
                        <div class="mt-1 hidden text-red-500 text-sm" id="emailError">유효한 이메일 주소를 입력해주세요.</div>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">연락처 <span class="text-red-500">*</span></label>
                        <input type="tel" id="phone" name="phone" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="010-1234-5678" required>
                        <div class="mt-1 hidden text-red-500 text-sm" id="phoneError">연락처를 입력해주세요.</div>
                    </div>
                </div>
            </section>

            <!-- 개인정보 수집 동의 -->
            <section class="mb-8">
                <div class="bg-gray-50 p-4 rounded-md">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            <input id="consent" name="consent" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="consent" class="font-medium text-gray-700">개인정보 수집 및 이용에 동의합니다. <span class="text-red-500">*</span></label>
                            <p class="text-gray-500 mt-1">수집된 개인정보는 행사 참여 확인 및 안내를 위해서만 사용되며, 행사 종료 후 1개월 내 파기됩니다.</p>
                        </div>
                    </div>
                    <div class="mt-1 hidden text-red-500 text-sm" id="consentError">개인정보 수집 및 이용에 동의해주세요.</div>
                </div>
            </section>

            <!-- 제출 버튼 -->
            <div class="text-center">
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-6 rounded-md text-lg font-medium transition duration-300 transform hover:scale-105">
                    예약하기
                </button>
            </div>
        </form>
    </main>

    <!-- 알림 모달 -->
    <div id="successModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="bg-white p-8 rounded-lg shadow-xl z-10 max-w-md w-full">
            <div class="text-center">
                <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">예약이 완료되었습니다!</h3>
                <p class="text-gray-600 mb-6" id="successMessage"></p>
                <div class="mt-6">
                    <button type="button" class="close-modal px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">확인</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 푸터 -->
    <footer class="text-center text-gray-500 text-sm mt-12">
        <p>© 2025 행사 예약 시스템. All rights reserved.</p>
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // !!! 중요: 여기에 1단계에서 복사한 구글 앱스 스크립트 웹 앱 URL을 붙여넣으세요 !!!
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6PebnLrnFdr1mANk03jlUn5ldl2Llj1CF7S-cSn49bNIcPZuB2_y1UjCaHr4ZNlJf3Q/exec'; 

        // 로컬 스토리지 데이터: 클라이언트 측에서 남은 자리 수를 보여주는 용도로 계속 사용합니다.
        // 실제 최종 데이터는 구글 시트에 저장됩니다.
        let reservations = JSON.parse(localStorage.getItem('eventReservations')) || {
            '2025-05-22': { '09:30-10:00': [], '10:00-10:30': [], '10:30-11:00': [], '11:00-11:30': [], '11:30-12:00': [] },
            '2025-05-23': { '09:30-10:00': [], '10:00-10:30': [], '10:30-11:00': [], '11:00-11:30': [], '11:30-12:00': [] },
            '2025-05-30': { '09:30-10:00': [], '10:00-10:30': [], '10:30-11:00': [], '11:00-11:30': [], '11:30-12:00': [] }
        };

        // 페이지 로드 시 예약 상태 UI 업데이트
        updateSlotStatus();

        // 날짜 탭 클릭 이벤트 (기존 코드 유지)
        document.querySelectorAll('.date-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // ... (기존 탭 전환 로직) ...
                 document.querySelectorAll('.date-tab').forEach(t => {
                    t.classList.remove('border-indigo-500', 'text-indigo-600');
                    t.classList.add('border-transparent', 'text-gray-500');
                });
                this.classList.remove('border-transparent', 'text-gray-500');
                this.classList.add('border-indigo-500', 'text-indigo-600');

                const dateId = this.getAttribute('data-date');
                document.querySelectorAll('.date-slots').forEach(slot => {
                    slot.classList.add('hidden');
                });
                document.getElementById(`slots-${dateId}`).classList.remove('hidden');
            });
        });


        // 시간 슬롯 클릭 이벤트 (숨겨진 필드 값 설정 추가)
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.addEventListener('click', function() {
                if (this.classList.contains('disabled')) {
                    return; // 마감된 슬롯 클릭 방지
                }
                // 모든 슬롯 선택 해제
                document.querySelectorAll('.time-slot').forEach(s => {
                    s.classList.remove('selected');
                });
                // 현재 슬롯 선택
                this.classList.add('selected');
                
                const date = this.getAttribute('data-date');
                const time = this.getAttribute('data-time');
                
                // 새로 추가한 숨겨진 필드에 값 설정
                document.getElementById('selectedDate').value = date;
                document.getElementById('selectedTime').value = time;
                document.getElementById('selectedDateTime').value = `${date} ${time}`; // 필요시 기존 필드도 유지

                // 시간 선택 오류 메시지 숨기기
                document.getElementById('timeSelectionError').classList.add('hidden');
            });
        });


        // 예약 폼 제출 이벤트 (★★★ 핵심 수정 부분 ★★★)
        const form = document.getElementById('registrationForm');
        const submitButton = form.querySelector('button[type="submit"]'); // 제출 버튼 요소 가져오기

        // 기존 form.addEventListener 부분을 아래 코드로 수정:
form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // 1. 유효성 검사
    if (!validateForm()) {
        return;
    }

    // 2. 버튼 비활성화
    submitButton.disabled = true;
    submitButton.textContent = '예약 처리 중...';
    submitButton.classList.add('opacity-50', 'cursor-not-allowed');

    // 3. 폼 데이터 준비 (JSON 형식으로 변환)
    const formData = {
        selectedDate: document.getElementById('selectedDate').value,
        selectedTime: document.getElementById('selectedTime').value,
        selectedDateTime: document.getElementById('selectedDateTime').value,
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value
    };

    // 4. fetch API로 JSON 데이터 전송
    fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Google Apps Script 응답:', data);
        if (data.result === "success") {
            // 성공 처리 로직
            const date = formData.selectedDate;
            const time = formData.selectedTime;
            
            // 로컬 저장소 업데이트
            if (reservations[date] && reservations[date][time]) {
                reservations[date][time].push({
                    name: formData.name,
                    email: formData.email,
                    phone: formData.phone,
                    registrationTime: new Date().toISOString()
                });
                localStorage.setItem('eventReservations', JSON.stringify(reservations));
            }

            // UI 업데이트 및 성공 모달 표시
            updateSlotStatus();
            showSuccessModal(date, time);
            resetForm();
        } else {
            // 실패 처리 로직
            console.error('Google Apps Script 오류:', data.message);
            alert(`예약 실패: ${data.message || '알 수 없는 서버 오류가 발생했습니다.'}`);
        }
    })
    .catch(error => {
        console.error('폼 제출 오류:', error);
        alert('예약 요청 중 네트워크 오류가 발생했습니다. 인터넷 연결을 확인하고 다시 시도해주세요.');
    })
    .finally(() => {
        // 버튼 활성화
        submitButton.disabled = false;
        submitButton.textContent = '예약하기';
        submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
    });
});


        // 모달 닫기 버튼 이벤트 (기존 코드 유지)
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('successModal').classList.add('hidden');
            });
        });

        // 폼 유효성 검사 함수 (수정: 숨겨진 날짜/시간 필드 검사 추가)
        function validateForm() {
            let isValid = true;
            
            // 시간 선택 확인 (숨겨진 필드 값 확인)
             const selectedDate = document.getElementById('selectedDate').value;
             const selectedTime = document.getElementById('selectedTime').value;
             const timeErrorDiv = document.getElementById('timeSelectionError');
             if (!selectedDate || !selectedTime) {
                 timeErrorDiv.classList.remove('hidden');
                 // 시간 선택 영역으로 스크롤 (사용자 경험 개선)
                 timeErrorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 isValid = false;
             } else {
                 timeErrorDiv.classList.add('hidden');
             }
            
            // --- 나머지 필드 유효성 검사는 기존 코드 유지 ---
            const name = document.getElementById('name');
            const nameError = document.getElementById('nameError');
            if (!name.value.trim()) {
                nameError.classList.remove('hidden');
                name.classList.add('field-error');
                isValid = false;
            } else {
                nameError.classList.add('hidden');
                name.classList.remove('field-error');
            }
            
            const email = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // 간단한 이메일 형식 검사
            if (!email.value.trim() || !emailPattern.test(email.value)) {
                emailError.textContent = '유효한 이메일 주소를 입력해주세요.';
                emailError.classList.remove('hidden');
                email.classList.add('field-error');
                isValid = false;
            } else {
                emailError.classList.add('hidden');
                email.classList.remove('field-error');
            }
            
            const phone = document.getElementById('phone');
            const phoneError = document.getElementById('phoneError');
             // 간단히 비어있는지만 확인. 필요시 정규식 패턴 추가 가능 (예: /^\d{3}-\d{3,4}-\d{4}$/)
            if (!phone.value.trim()) {
                phoneError.textContent = '연락처를 입력해주세요.';
                phoneError.classList.remove('hidden');
                phone.classList.add('field-error');
                 isValid = false;
            } else {
                phoneError.classList.add('hidden');
                phone.classList.remove('field-error');
            }
            
            const consent = document.getElementById('consent');
            const consentError = document.getElementById('consentError');
            if (!consent.checked) {
                consentError.classList.remove('hidden');
                // 동의 체크박스 부분 시각적 강조 (흔들림 효과)
                consent.closest('div.bg-gray-50').classList.add('shake'); 
                setTimeout(() => consent.closest('div.bg-gray-50').classList.remove('shake'), 500); // 0.5초 후 효과 제거
                isValid = false;
            } else {
                consentError.classList.add('hidden');
            }
            // --- 유효성 검사 끝 ---

             // 유효성 검사 실패 시 첫 번째 오류 필드로 포커스 이동
             if (!isValid) {
                 const firstErrorField = form.querySelector('.field-error');
                 const firstErrorMsg = form.querySelector('.text-red-500:not(.hidden)'); // 보이는 첫 에러 메시지

                 if (firstErrorField) {
                     firstErrorField.focus(); // 입력 필드에 포커스
                      firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 } else if (firstErrorMsg && firstErrorMsg.id === 'timeSelectionError') {
                     // 시간 선택 오류 시 시간 슬롯 영역으로 이동
                     document.querySelector('.time-slot')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 } else if (firstErrorMsg && firstErrorMsg.id === 'consentError') {
                     // 동의 오류 시 동의 체크박스로 이동
                     consent.focus();
                     consent.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 }

                 // 전체 폼 흔들림 효과로 시각적 피드백 강화
                 form.classList.add('shake');
                 setTimeout(() => form.classList.remove('shake'), 500);
             }

            return isValid;
        }

        // 로컬 저장소 기준 이메일 중복 확인 함수 (클라이언트 측 예비 확인용)
        function isEmailAlreadyRegisteredLocally(email) {
            for (const date in reservations) {
                for (const time in reservations[date]) {
                    // 각 시간대 배열 순회
                    for (const registration of reservations[date][time]) {
                        if (registration.email === email) {
                            return true; // 중복 발견
                        }
                    }
                }
            }
            return false; // 중복 없음
        }

        // 예약 슬롯 상태 UI 업데이트 함수 (기존 코드 유지, 오류 방지 강화)
        function updateSlotStatus() {
            document.querySelectorAll('.time-slot').forEach(slot => {
                const date = slot.getAttribute('data-date');
                const time = slot.getAttribute('data-time');
                
                // 해당 날짜/시간 데이터가 없으면 0으로 처리 (오류 방지)
                 const registered = (reservations[date] && reservations[date][time]) ? reservations[date][time].length : 0;

                const total = 20; // 시간당 최대 인원
                const remaining = total - registered;
                
                // 남은 자리 수 표시 (음수 방지)
                slot.querySelector('.remaining-count').textContent = Math.max(0, remaining);
                
                // 진행률 바 업데이트 (0% ~ 100% 범위 유지)
                const percentage = Math.max(0, Math.min(100, (registered / total) * 100));
                slot.querySelector('.progress-fill').style.width = `${percentage}%`;
                
                // 상태에 따른 스타일 변경 (기존 로직 유지)
                const countBadge = slot.querySelector('span.text-sm');
                const progressBarFill = slot.querySelector('.progress-fill');

                // 기존 클래스 초기화
                slot.classList.remove('disabled');
                countBadge.classList.remove('bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800', 'bg-red-100', 'text-red-800');
                progressBarFill.style.backgroundColor = '#4F46E5'; // 기본 파란색

                if (remaining <= 0) {
                    slot.classList.add('disabled'); // 마감 처리
                    countBadge.classList.add('bg-red-100', 'text-red-800');
                    progressBarFill.style.backgroundColor = '#EF4444'; // 빨간색
                } else if (remaining <= 5) { // 마감 임박 (예: 5명 이하)
                    countBadge.classList.add('bg-yellow-100', 'text-yellow-800');
                    progressBarFill.style.backgroundColor = '#F59E0B'; // 주황색
                } else { // 여유 있음
                    countBadge.classList.add('bg-green-100', 'text-green-800');
                    // progressBarFill 색상은 기본 파란색 유지
                }
            });
        }

        // 성공 모달 표시 함수 (기존 코드 유지)
        function showSuccessModal(date, time) {
            const formattedDate = formatDate(date); // 날짜 형식 변환
            document.getElementById('successMessage').textContent = 
                `${formattedDate}, ${time} 시간대에 예약이 성공적으로 완료되었습니다. 확인 이메일이 발송될 예정입니다. (실제 발송 기능은 미구현)`;
            document.getElementById('successModal').classList.remove('hidden');
        }

        // 날짜 형식 변환 함수 (기존 코드 유지)
        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00'); // 시간대 문제 방지
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = ['일', '월', '화', '수', '목', '금', '토'][date.getDay()];
            return `${year}년 ${month}월 ${day}일 (${dayOfWeek})`;
        }

        // 폼 초기화 함수 (기존 코드 유지, 숨겨진 필드 초기화 추가)
        function resetForm() {
            form.reset(); // 폼 요소들 초기화
            document.getElementById('selectedDate').value = ''; // 숨겨진 필드 초기화
            document.getElementById('selectedTime').value = '';
            document.getElementById('selectedDateTime').value = '';
            document.querySelectorAll('.time-slot').forEach(s => {
                s.classList.remove('selected'); // 시간 슬롯 선택 해제
            });
             // 모든 에러 메시지 숨기기
             form.querySelectorAll('.text-red-500').forEach(el => el.classList.add('hidden'));
             form.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
        }
    });
</script>
</body>
</html>
